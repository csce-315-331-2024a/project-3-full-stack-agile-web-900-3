<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/cashierPage.css"></link>
<title>Cashier Page</title>
<style>
  
</style>
</head>
<body>
<div class="container">
    <div class="sidebar">
        <h2>Current Order</h2>
        <!-- <p id="outputText"></p> -->
        <div id="outputContainer"></div>
        <p id="orderTotal">Order Total: $0.00</p>
        <button id="placeOrder">Place Order</button>
        
    </div>
    <div class="grid">
  <div class="grid-item" th:each="item: ${products}">
    
    <button class="button" id="${item.product_type}" th:text="${item.productname}">button</button>
    <input type="hidden" class="item-price" value="${item.price}" />
  </div>
</div>
</div>


<script>

  // var outputParagraph = document.getElementById('outputText');
  // var buttons = document.getElementsByClassName('button');
  // for (var i = 0; i < buttons.length; i++) {
  //   buttons[i].addEventListener('click', function() {
  //     outputParagraph.textContent = outputParagraph.textContent +" | \n" + this.textContent;
  //   });
  // }

  // function updateText() {
  //   var newText = document.getElementById('newText').value;
  //   var xhr = new XMLHttpRequest();
  //   xhr.open("POST", "/updateText", true);
  //   xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
  //   xhr.send("newText=" + newText);
  //   xhr.onreadystatechange = function() {
  //       if (xhr.readyState === 4 && xhr.status === 200) {
  //           document.getElementById('outputText').textContent = xhr.responseText;
  //       }
  //   }
//}

  var outputContainer = document.getElementById('outputContainer');
  var orderTotalParagraph = document.getElementById('orderTotal');
  var buttons = document.getElementsByClassName('button');

  for (var i = 0; i < buttons.length; i++) {
    buttons[i].addEventListener('click', function() {
      var itemName = this.textContent;
      var itemPrice = parseFloat(this.nextElementSibling.value); 
      addItemToList(itemName, itemPrice);
    });
  }

  function addItemToList(itemName, itemPrice) {
    var itemButton = document.createElement('button');
    itemButton.textContent = itemName + ' - $' + itemPrice.toFixed(2); 
    itemButton.classList.add('ordered-item');
    itemButton.setAttribute('data-price', itemPrice); 
    itemButton.addEventListener('click', function() {
      openEditWindow(itemButton);
    });
    outputContainer.appendChild(itemButton);
    updateOrderTotal(); 
  }
  
  function openEditWindow(button) {
    var editWindow = window.open('', '_blank', 'width=300,height=200');
    var label = document.createElement('label');
    label.textContent = button.textContent;
    editWindow.document.body.appendChild(label);

    
    var numberLabel = document.createElement('label');
    numberLabel.textContent = '\nQuantity:';
    editWindow.document.body.appendChild(numberLabel);
    

    var numberInput = document.createElement('input');
    numberInput.type = 'number';
    numberInput.value = 1; 
    numberInput.style.width = '50px';
    editWindow.document.body.appendChild(numberInput);
    

    var saveButton = document.createElement('button');
    saveButton.textContent = 'Save';
    saveButton.addEventListener('click', function() {
      button.textContent = button.textContent + '(' + numberInput.value + ')';
      editWindow.close();
    });
    editWindow.document.body.appendChild(saveButton);

    var deleteButton = document.createElement('button');
    deleteButton.textContent = 'Delete';
    deleteButton.addEventListener('click', function() {
      button.remove();
      editWindow.close();
    });
    editWindow.document.body.appendChild(deleteButton);
  
  }

  function updateText() {
    var newText = document.getElementById('newText').value;
    var xhr = new XMLHttpRequest();
    xhr.open("POST", "/updateText", true);
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhr.send("newText=" + newText);
    xhr.onreadystatechange = function() {
        if (xhr.readyState === 4 && xhr.status === 200) {
            document.getElementById('outputText').textContent = xhr.responseText;
        }
    }
  }
  function updateOrderTotal() {
        var orderedItems = document.getElementsByClassName('ordered-item');
        var total = 0;
        for (var i = 0; i < orderedItems.length; i++) {
            var price = parseFloat(orderedItems[i].getAttribute('data-price'));
            total += price;
        }
        orderTotalParagraph.textContent = 'Order Total: $' + total.toFixed(2);
    }

</script>
</body>
</html>