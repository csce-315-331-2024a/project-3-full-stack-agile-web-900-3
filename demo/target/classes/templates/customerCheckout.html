<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout - Revs Ordering System</title>
  <link rel="stylesheet" href="/checkout.css">
</head>

<body>
  <div class="checkout-container">
    <h1>Checkout</h1>
    <form id="checkout-form" action="/customer/checkout" method="post">
      <div class="form-group">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required>
      </div>
      <div class="form-group">
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>
      </div>
      <div class="form-group">
        <label for="address">Address:</label>
        <input type="text" id="address" name="address" required>
      </div>
      <div class="form-group">
        <label for="phone">Phone:</label>
        <input type="tel" id="phone" name="phone" required>
      </div>
      <div class="form-group">
        <input type="hidden" id="productId" name="productId">
        <input type="hidden" id="price" name="price">
        <input type="submit" value="Place Order" class="submit-button">
      </div>
      <button class="back-button" onclick="orderPlaced()">Back to Menu</button>
    </form>

  </div>
  <script>
    function orderPlaced() {
      localStorage.clear();
      window.location.href='/customer';
    }
    const savedOrderDetails = localStorage.getItem('orderDetails');
    if (savedOrderDetails) {
      const orderDetails = JSON.parse(savedOrderDetails);
      console.log('Loaded order details (parsed):', orderDetails); // Debugging log
      var productIds = [];
      var totalPrice = 0;

      orderDetails.forEach(detail => {
        productIds.push(detail.productId);
        totalPrice += detail.price;
      });

      const stateTaxRate = 1.08; // 8% state tax
      totalPrice *= stateTaxRate;

      const productList = productIds.join("-");

      const formProducts = document.getElementById("productId");
      const formPrice = document.getElementById("price");
      formProducts.value = productList;
      formPrice.value = totalPrice;

    } else {
      console.log('No order details found in localStorage.');
    }
  </script>
</body>

</html>